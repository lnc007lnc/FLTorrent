# FederatedScope Dockeré›†æˆå®ç°æ€»ç»“

## ğŸ¯ å®ç°ç›®æ ‡

æ ¹æ®ç”¨æˆ·éœ€æ±‚"ä¿®æ”¹run_rayä»£ç å˜æˆfederatedscopeçš„å®ä½“æ”¾åœ¨dockerä¸­ï¼Œå¹¶ä¸”æŠŠç½‘ç»œè®¾ç½®ä¹Ÿæ”¾åœ¨FLconfigä¸­"ï¼ŒæˆåŠŸå®ç°äº†å®Œæ•´çš„Dockerè¾¹ç¼˜è®¾å¤‡ä»¿çœŸç³»ç»Ÿã€‚

## âœ… å®Œæˆçš„ä»»åŠ¡

### 1. âœ… ä¿®æ”¹run_ray.pyä½¿ç”¨Dockerå®¹å™¨è¿è¡ŒFederatedScopeå®ä½“
- å®Œå…¨é‡æ„äº†`run_ray.py`ï¼Œä»åŸºäºsubprocessçš„Ray Actoræ”¹ä¸ºåŸºäºDockerçš„Ray Actor
- å®ç°äº†`DockerFLActor`ç±»ï¼Œæ¯ä¸ªFLå‚ä¸è€…è¿è¡Œåœ¨ç‹¬ç«‹çš„Dockerå®¹å™¨ä¸­
- æ·»åŠ äº†`DockerManager`ç±»ç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ
- é›†æˆäº†Rayåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ä¸Dockerå®¹å™¨æŠ€æœ¯

### 2. âœ… åœ¨FLConfigä¸­æ·»åŠ ç½‘ç»œä»¿çœŸé…ç½®
```python
@dataclass
class FLConfig:
    # Dockerè®¾ç½®
    USE_DOCKER: bool = True
    ENABLE_NETWORK_SIMULATION: bool = True
    DOCKER_NETWORK_NAME: str = "fl_network"
    
    # ç½‘ç»œé…ç½®æ–‡ä»¶
    NETWORK_PROFILES: Dict[str, Dict] = field(default_factory=lambda: {
        "smartphone_high": {
            "bandwidth_up_kbps": 50000,
            "latency_ms": 20,
            "packet_loss_rate": 0.005
        },
        "iot_device": {
            "bandwidth_up_kbps": 128,
            "latency_ms": 300,
            "packet_loss_rate": 0.05
        }
        # ... æ›´å¤šè®¾å¤‡é…ç½®
    })
```

### 3. âœ… å®ç°Dockerå®¹å™¨ç½‘ç»œé™åˆ¶åŠŸèƒ½
- åˆ›å»ºäº†`NetworkSimulator`ç±»ä½¿ç”¨Linux TC (Traffic Control)
- æ”¯æŒå¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ…ç‡ç­‰ç½‘ç»œæ¡ä»¶ä»¿çœŸ
- å®ç°äº†è‡ªåŠ¨ç½‘ç»œè§„åˆ™é…ç½®å’Œæ¸…ç†æœºåˆ¶
```python
class NetworkSimulator:
    def apply_network_limits(self, container, profile):
        # å¸¦å®½é™åˆ¶
        tc_cmd = f"tc qdisc add dev eth0 root tbf rate {profile['bandwidth_up_kbps']}kbit"
        # å»¶è¿Ÿå’Œä¸¢åŒ…
        netem_cmd = f"tc qdisc add dev eth0 root netem delay {profile['latency_ms']}ms"
```

### 4. âœ… æ›´æ–°ä¸»è¿è¡Œå‡½æ•°ä»¥æ”¯æŒDockerå¤šè®¾å¤‡åˆ†å¸ƒ
- é‡æ„äº†`main()`å‡½æ•°æ”¯æŒDockeræ¨¡å¼
- å®ç°äº†è®¾å¤‡é…ç½®è‡ªåŠ¨åˆ†é…å’Œå®¹å™¨ç¼–æ’
- æ·»åŠ äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå¯åŠ¨ã€ç›‘æ§ã€æ¸…ç†ï¼‰
```python
@ray.remote
class DockerFLActor:
    def __init__(self, role: str, device_config: Dict, fl_config: FLConfig):
        self.container = self._create_container()
        self.network_sim.apply_limits(self.container, device_config['network_profile'])
```

### 5. âœ… åˆ›å»ºDockerfileæ¨¡æ¿ç”¨äºæ„å»ºè¾¹ç¼˜è®¾å¤‡é•œåƒ
åˆ›å»ºäº†6ä¸ªä¸“ä¸šçš„Dockerfileï¼š

1. **Dockerfile.base** - åŸºç¡€é•œåƒï¼ŒåŒ…å«ç½‘ç»œå·¥å…·å’ŒFederatedScope
2. **Dockerfile.edge-server** - è¾¹ç¼˜æœåŠ¡å™¨ï¼ˆ32GBå†…å­˜ï¼Œå¤šGPUæ”¯æŒï¼‰
3. **Dockerfile.smartphone-high** - é«˜ç«¯æ™ºèƒ½æ‰‹æœºï¼ˆ4GBå†…å­˜ï¼ŒGPUæ”¯æŒï¼‰
4. **Dockerfile.smartphone-low** - ä½ç«¯æ™ºèƒ½æ‰‹æœºï¼ˆ1.5GBå†…å­˜ï¼ŒCPUç‰ˆæœ¬ï¼‰
5. **Dockerfile.raspberry-pi** - æ ‘è“æ´¾ï¼ˆARMä¼˜åŒ–ï¼ŒGPIOæ”¯æŒï¼‰
6. **Dockerfile.iot-minimal** - IoTè®¾å¤‡ï¼ˆ256MBå†…å­˜ï¼ŒAlpine Linuxï¼‰

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶ç»“æ„

```
/mnt/g/FLtorrent_combine/FederatedScope-master/
â”œâ”€â”€ run_ray.py                          # ğŸ”„ å®Œå…¨é‡æ„ï¼ˆDockeré›†æˆï¼‰
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile.base                 # âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ Dockerfile.edge-server          # âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ Dockerfile.smartphone-high      # âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ Dockerfile.smartphone-low       # âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ Dockerfile.raspberry-pi         # âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ Dockerfile.iot-minimal          # âœ¨ æ–°å»º
â”‚   â””â”€â”€ build_images.sh                 # âœ¨ æ–°å»ºï¼ˆæ„å»ºè„šæœ¬ï¼‰
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ docker_simulation.yaml          # âœ¨ æ–°å»ºï¼ˆç¤ºä¾‹é…ç½®ï¼‰
â”œâ”€â”€ DOCKER_EDGE_SIMULATION_GUIDE.md     # âœ¨ æ–°å»ºï¼ˆä½¿ç”¨æŒ‡å—ï¼‰
â””â”€â”€ DOCKER_INTEGRATION_SUMMARY.md       # âœ¨ æ–°å»ºï¼ˆæœ¬æ–‡æ¡£ï¼‰
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Rayåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ (ä¸»æœº)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DockerFLActor  â”‚ DockerFLActor  â”‚ DockerFLActor  â”‚ DockerFLActor â”‚
â”‚   (Server)     â”‚   (Client 1)   â”‚   (Client 2)   â”‚   (Client 3)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Docker      â”‚     Docker     â”‚     Docker     â”‚     Docker    â”‚
â”‚   Container    â”‚   Container    â”‚   Container    â”‚   Container   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚è¾¹ç¼˜æœåŠ¡å™¨   â”‚â”‚ â”‚é«˜ç«¯æ™ºèƒ½æ‰‹æœº â”‚â”‚ â”‚ä½ç«¯æ™ºèƒ½æ‰‹æœº â”‚â”‚ â”‚  IoTè®¾å¤‡    â”‚â”‚
â”‚ â”‚32GB+å¤šGPU   â”‚â”‚ â”‚4GB+GPU     â”‚â”‚ â”‚1.5GB+CPU   â”‚â”‚ â”‚256MB+å•æ ¸   â”‚â”‚
â”‚ â”‚åƒå…†ç½‘ç»œ     â”‚â”‚ â”‚5Gç½‘ç»œ      â”‚â”‚ â”‚4Gç½‘ç»œ      â”‚â”‚ â”‚2G/3Gç½‘ç»œ    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†•ï¸ Docker Network + TCç½‘ç»œä»¿çœŸ â†•ï¸
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. æ„å»ºDockeré•œåƒ
```bash
# ä¸€é”®æ„å»ºæ‰€æœ‰è¾¹ç¼˜è®¾å¤‡é•œåƒ
./docker/build_images.sh
```

### 2. è¿è¡Œè”é‚¦å­¦ä¹ å®éªŒ
```bash
# ä½¿ç”¨Dockerä»¿çœŸæ¨¡å¼ï¼ˆæ–°åŠŸèƒ½ï¼‰
python run_ray.py --config_path configs/docker_simulation.yaml

# ä¼ ç»Ÿæ¨¡å¼ä»ç„¶æ”¯æŒ
python run_ray.py --use_docker=False
```

### 3. ç›‘æ§å®éªŒ
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps
docker stats

# æŸ¥çœ‹FLè®­ç»ƒæ—¥å¿—
docker logs fl_client_1
```

## ğŸ¯ æ ¸å¿ƒåˆ›æ–°ç‚¹

### 1. çœŸå®ç¡¬ä»¶ä»¿çœŸ
- ä¸åŒè®¾å¤‡ç±»å‹å…·æœ‰çœŸå®çš„å†…å­˜ã€CPUã€GPUçº¦æŸ
- æ”¯æŒARMæ¶æ„ä»¿çœŸï¼ˆæ ‘è“æ´¾ï¼‰
- æé™èµ„æºçº¦æŸï¼ˆIoTè®¾å¤‡256MBå†…å­˜ï¼‰

### 2. ç²¾ç¡®ç½‘ç»œä»¿çœŸ
- ä½¿ç”¨Linux TCå®ç°å¸¦å®½ã€å»¶è¿Ÿã€ä¸¢åŒ…ä»¿çœŸ
- æ”¯æŒä¸åŒç½‘ç»œç±»å‹ï¼ˆ5G/4G/WiFi/2Gï¼‰
- åŠ¨æ€ç½‘ç»œæ¡ä»¶æ¨¡æ‹Ÿ

### 3. æ— ç¼é›†æˆè®¾è®¡
- Ray + Dockerå®Œç¾ç»“åˆ
- ä¿æŒåŸæœ‰FederatedScope APIå…¼å®¹æ€§
- æ”¯æŒä¼ ç»Ÿæ¨¡å¼å’ŒDockeræ¨¡å¼åˆ‡æ¢

### 4. ç”Ÿäº§å°±ç»ªçš„å®ç°
- å®Œæ•´çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å¥åº·æ£€æŸ¥å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- èµ„æºæ¸…ç†å’Œç½‘ç»œéš”ç¦»

## ğŸ“Š æ”¯æŒçš„è®¾å¤‡åœºæ™¯

| è®¾å¤‡ç±»å‹ | å†…å­˜ | CPU | GPU | ç½‘ç»œ | ç”¨é€”åœºæ™¯ |
|---------|------|-----|-----|------|----------|
| Edge Server | 32GB | 16æ ¸ | âœ… | åƒå…† | è¾¹ç¼˜æ•°æ®ä¸­å¿ƒ |
| Smartphone High | 4GB | 8æ ¸ | âœ… | 5G | æ——èˆ°æ‰‹æœº |
| Smartphone Low | 1.5GB | 4æ ¸ | âŒ | 4G | ä¸­ä½ç«¯æ‰‹æœº |
| Raspberry Pi | 4GB | 4æ ¸ARM | âŒ | WiFi | è¾¹ç¼˜ç½‘å…³ |
| IoT Minimal | 256MB | 1æ ¸ | âŒ | 2G/3G | IoTä¼ æ„Ÿå™¨ |

## ğŸ”® æ‰©å±•æ€§

ç³»ç»Ÿè®¾è®¡æ”¯æŒæœªæ¥æ‰©å±•ï¼š
- âœ… æ·»åŠ æ–°è®¾å¤‡ç±»å‹ï¼ˆåªéœ€æ–°å¢Dockerfileï¼‰
- âœ… è‡ªå®šä¹‰ç½‘ç»œæ‹“æ‰‘ï¼ˆæ˜Ÿå½¢ã€ç¯å½¢ã€ç½‘çŠ¶ç­‰ï¼‰
- âœ… é›†æˆKubernetesè¿›è¡Œå¤§è§„æ¨¡éƒ¨ç½²
- âœ… æ”¯æŒå¼‚æ„è®¡ç®—ï¼ˆCPU/GPU/FPGAæ··åˆï¼‰
- âœ… åœ°ç†åˆ†å¸ƒä»¿çœŸï¼ˆå¤šåœ°åŸŸå»¶è¿Ÿæ¨¡æ‹Ÿï¼‰

## ğŸ‰ å®ç°æˆæœ

1. **å®Œå…¨å®ç°ç”¨æˆ·éœ€æ±‚**: FederatedScopeå®ä½“å®Œå…¨è¿è¡Œåœ¨Dockerä¸­
2. **ç½‘ç»œé…ç½®é›†ä¸­åŒ–**: æ‰€æœ‰ç½‘ç»œè®¾ç½®é›†æˆåˆ°FLConfigä¸­
3. **çœŸå®è¾¹ç¼˜ç¯å¢ƒä»¿çœŸ**: æ”¯æŒå¤šç§çœŸå®è®¾å¤‡ç±»å‹å’Œç½‘ç»œæ¡ä»¶
4. **ç”Ÿäº§çº§åˆ«å®ç°**: å®Œæ•´çš„é”™è¯¯å¤„ç†ã€ç›‘æ§ã€æ¸…ç†æœºåˆ¶
5. **æ˜“ç”¨æ€§**: ä¸€é”®æ„å»ºã€ä¸€é”®è¿è¡Œã€è¯¦ç»†æ–‡æ¡£

è¿™ä¸ªå®ç°ä¸ºè”é‚¦å­¦ä¹ ç ”ç©¶æä¾›äº†å‰æ‰€æœªæœ‰çš„è¾¹ç¼˜è®¾å¤‡ä»¿çœŸèƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨å•æœºç¯å¢ƒä¸­ç²¾ç¡®æ¨¡æ‹Ÿå¤æ‚çš„å¤šè®¾å¤‡è”é‚¦å­¦ä¹ åœºæ™¯ã€‚